<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.bionime.mapper.EquipmentMapper">
	<resultMap type="com.bionime.pojo.EquipmentExt" id="EquipmentAndTypeRsMap">
		<id column="id" property="id"/>
		<result column="sn" property="sn"/>
		<result column="status" property="status"/>
		<result column="property_no" property="property_no"/>
		<association property="equipmentType" javaType="com.bionime.pojo.EquipmentType">
			<id column="id" property="id"/>
			<result column="name" property="name"/>
			<result column="type" property="type"/>
		</association>	
	</resultMap>
	
	<!-- 设备新增 -->
	<insert id="insert"  parameterType="java.util.List">
		insert into equipment (sn,status,in_time,description,et_id,property_no,delete_tag)
		values
		<foreach collection="list" item="item" separator=",">
           (#{item.sn},1,#{item.in_time},#{item.description},#{item.et_id},#{item.property_no},'0')
        </foreach>
	</insert>
	
	<!-- 根据设备设备类型查找设备 -->
	<select id="selectByType" parameterType="com.bionime.pojo.EquipmentType" resultType="com.bionime.pojo.Equipment">
		select * from equipment where et_id=#{id}
	</select>
	
	<!-- 根据序列号查找设备 -->
	<select id="selectBySn" parameterType="java.lang.String" resultType="com.bionime.pojo.Equipment">
		select * from equipment where sn in
		<foreach collection="list" index="index" item="item" open="(" separator="," close=")">
            #{item}
        </foreach>
	</select>
	
	<!-- 批量修改设备状态 -->
	<update id="statusChange">
		update equipment set status=#{status} where id in 
		<foreach collection="ids" index="index" item="item" open="(" separator="," close=")">
            #{item}
        </foreach>
	</update>
	
	<!-- 所有设备的信息，外联EquipmentType -->
	<!-- <select id="selectEquimentExt" resultMap="EquipmentAndTypeRsMap"> -->
	<select id="selectEquimentExt" resultType="com.bionime.pojo.EquipmentExt">
		select 
			equipment.id,
			equipment.sn,
			equipment_type.name,
			equipment_type.type,
			equipment.in_time,
			equipment.property_no,
			equipment.status
		from equipment left join equipment_type
		on equipment.et_id=equipment_type.id
		where equipment.delete_tag=0
	</select>
	<!-- 所有设备的信息，外联EquipmentType,并分页查询 -->
	<select id="selectEquimentExtByPage" parameterType="java.lang.Integer" resultType="com.bionime.pojo.EquipmentExt">
        select 
			equipment.id,
			equipment.sn,
			equipment_type.name,
			equipment_type.type,
			equipment.in_time,
			equipment.property_no,
			equipment.status
		from equipment left join equipment_type
		on equipment.et_id=equipment_type.id
		where equipment.delete_tag=0 limit #{page} , #{pageSize}
	</select>
</mapper>